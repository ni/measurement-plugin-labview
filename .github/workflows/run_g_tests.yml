name: Run G Tests

on:
  workflow_call:
  workflow_dispatch:

jobs:
  run_g_tests:
    name: Run G Tests
    runs-on: 
      - self-hosted
      - windows
      - x64
      - rdss-measlinkbot-win-10-lv64
    steps:
    - name: Enable git long paths
      run: git config  --global core.longpaths true

    - uses: actions/checkout@v4

    - uses: actions/setup-python@v5
      with:
        python-version: '3.9'

    # - name: Remove some test folder
    #   run: |
    #     rm "${{runner.workspace}}/measurementlink-labview/Source/Tests/Tests.Generator" -r -force
    #     rm "${{runner.workspace}}/measurementlink-labview/Source/Tests/Tests.Runtime/Discovery Client" -r -force

    - name: Run G Tests LV2020
      run:
        LabVIEWCLI.exe -OperationName "RunVI" -VIPath "${{runner.workspace}}\measurementlink-labview\Source\Tests\run_tests.vi" -LabVIEWPath "C:\Program Files\National Instruments\LabVIEW 2020\LabVIEW.exe" -PortNumber 3363 -Verbosity Detailed
      
    - name: Close LV2020
      run:
        LabVIEWCLI.exe -OperationName "CloseLabVIEW" -LabVIEWPath "C:\Program Files\National Instruments\LabVIEW 2020\LabVIEW.exe" -PortNumber 3363
        
    - name: Run G Tests LV2021
      run:
        LabVIEWCLI.exe -OperationName "RunVI" -VIPath "${{runner.workspace}}\measurementlink-labview\Source\Tests\run_tests.vi" -LabVIEWPath "C:\Program Files\National Instruments\LabVIEW 2021\LabVIEW.exe" -PortNumber 3364 -Verbosity Detailed
        
    - name: Close LV2021
      run:
        LabVIEWCLI.exe -OperationName "CloseLabVIEW" -LabVIEWPath "C:\Program Files\National Instruments\LabVIEW 2021\LabVIEW.exe" -PortNumber 3364 
  
    - name: Run G Tests LV2022
      run:
        LabVIEWCLI.exe -OperationName "RunVI" -VIPath "${{runner.workspace}}\measurementlink-labview\Source\Tests\run_tests.vi" -LabVIEWPath "C:\Program Files\National Instruments\LabVIEW 2022\LabVIEW.exe" -PortNumber 3365 -Verbosity Detailed

    - name: Close LV2022
      run:
        LabVIEWCLI.exe -OperationName "CloseLabVIEW" -LabVIEWPath "C:\Program Files\National Instruments\LabVIEW 2022\LabVIEW.exe" -PortNumber 3365
  
    - name: Run G Tests LV2023
      run:
        LabVIEWCLI.exe -OperationName "RunVI" -VIPath "${{runner.workspace}}\measurementlink-labview\Source\Tests\run_tests.vi" -LabVIEWPath "C:\Program Files\National Instruments\LabVIEW 2023\LabVIEW.exe" -PortNumber 3366 -Verbosity Detailed

    - name: Close LV2023
      run:
        LabVIEWCLI.exe -OperationName "CloseLabVIEW" -LabVIEWPath "C:\Program Files\National Instruments\LabVIEW 2023\LabVIEW.exe" -PortNumber 3366
  
  